(this["webpackJsonpturnips-tracker"]=this["webpackJsonpturnips-tracker"]||[]).push([[0],{153:function(e,t,n){},154:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(49),i=n.n(o),l=(n(58),n(23)),c=(n(153),n(51)),s=n(4),u=n(8),d=n(5),p=n(6),f=n(14),h=n.n(f);function v(e){return 0===h()(e,"yyyy-MM-DD").weekday()}var m,b=n(52);function E(e){return e.half?e.date+"-"+e.half:e.date}!function(e){e.Morning="morning",e.Afternoon="afternoon"}(m||(m={}));var y,g=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e,a,r){var o;return Object(s.a)(this,n),(o=t.call(this,null!==r&&void 0!==r?r:"Could not normalize TurnipsEntry: ".concat(e," (").concat(a,")"))).reason=void 0,o.reason=e,o}return n}(Object(b.a)(Error));function C(e){var t=v(e.date);if(!t&&!e.half)throw new g(y.DayHalfExpected,e);return{date:e.date,half:t?void 0:e.half,bought:t?R(e.bought):void 0,sold:t?void 0:R(e.sold),price:R(e.price)}}function R(e){if(!e)return 0;if("number"===typeof e)return e;var t=parseInt(e,10);return isNaN(t)||!isFinite(t)?0:t}function w(e,t){return e.date===t.date?e.half===m.Morning&&t.half===m.Afternoon?-1:1:function(e,t){if(!e||!t)return Number.MIN_SAFE_INTEGER;if(e===t)return 0;var n=e.split("-"),a=t.split("-");if(3!==n.length||3!==a.length)return Number.MIN_SAFE_INTEGER;for(var r=0;r<3;r++){var o=parseInt(n[r]),i=parseInt(a[r]);if(isNaN(o)||isNaN(i))return Number.MIN_SAFE_INTEGER;if(o!==i)return o<i?-1:1}return 0}(e.date,t.date)}function D(e){var t=[],n=[],a=[];function r(e,t,n){return{label:e,data:t,pointRadius:4,pointHoverRadius:6,borderWidth:4,spanGaps:!0,pointBackgroundColor:n,backgroundColor:n,borderColor:n}}return e.forEach((function(e){var r=e.price;if(null!=e.sold){var o=e.half===m.Morning?"am":"pm";t.push(e.date+o),n.push(r),a.push(null)}else t.push(e.date),n.push(null),a.push(r)})),{labels:t,datasets:[r("Selling Price",n,"rgba(30, 144, 255, 0.2)"),r("Buying Price",a,"rgba(255, 215, 0, 0.2)")],options:{scales:{yAxes:[{stacked:!0}]}}}}function S(e){var t=[],n=[],a=0,r=0;return e.sort(w).forEach((function(e){if(null!=e.sold){if(0===t.length)return;r+=e.sold*e.price}else{var o;0!==t.length&&n.push(r-a);var i=null!==(o=e.bought)&&void 0!==o?o:0;t.push(e.date),a=i*e.price,r=0}})),(a>0||r>0)&&n.push(r-a),{labels:t,datasets:[{label:"Profit",data:n}]}}!function(e){e.DayHalfExpected="DayHalf expected"}(y||(y={}));var k=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a,r;Object(s.a)(this,n),(r=t.call(this,e)).validateForm=function(){return r.setState({formValid:0!==r.state.date.length})},r.handleInputChange=function(e){var t=e.currentTarget,n=t.name,a=t.value;r.setState(Object(c.a)({},n,a),r.validateForm)},r.handleSubmit=function(e){if(e.preventDefault(),r.state.formValid){var t,n=r.state.date,a=r.state.half,o=r.state.price,i=r.state.quantity;t=v(n)?{date:n,bought:i,price:o}:{date:n,half:a,sold:i,price:o};var l=r.props.tableRef.current;l.addEntry(t);var c=l.state.entries,s=r.props.priceChartRef.current;s.chartInstance.data=D(c),s.chartInstance.update(),r.props.priceChartContainerRef.current.style.removeProperty("display");var u=r.props.profitChartRef.current;u.chartInstance.data=S(c),u.chartInstance.update(),r.props.profitChartContainerRef.current.style.removeProperty("display")}};var o,i=new Date;return r.state={hidden:null!==(a=e.hidden)&&void 0!==a&&a,formValid:!0,date:(o=i,h()(o).format("yyyy-MM-DD")),half:i.getHours()<12?m.Morning:m.Afternoon,price:0,quantity:0},r}return Object(u.a)(n,[{key:"render",value:function(){return r.a.createElement("form",{onSubmit:this.handleSubmit,style:{display:this.state.hidden?"none":"unset"}},r.a.createElement("label",null,"Date:",r.a.createElement("input",{name:"date",type:"date",value:this.state.date,onChange:this.handleInputChange})),r.a.createElement("label",null,"Half:",r.a.createElement("select",{name:"half",value:this.state.half,onChange:this.handleInputChange},r.a.createElement("option",{value:"morning"},"Morning"),r.a.createElement("option",{value:"afternoon"},"Afternoon"))),r.a.createElement("label",null,"Price:",r.a.createElement("input",{name:"price",type:"number",value:this.state.price,onChange:this.handleInputChange})),r.a.createElement("label",null,"Quantity:",r.a.createElement("input",{name:"quantity",type:"number",value:this.state.quantity,onChange:this.handleInputChange})),r.a.createElement("button",{type:"submit",disabled:!this.state.formValid},"Add"))}}]),n}(r.a.Component),I=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(s.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).turnipsFileInputRef=r.a.createRef(),e.downloadDataFakeLinkRef=r.a.createRef(),e.createNewData=function(t){t.preventDefault(),e.props.entryEditorRef.current.setState({hidden:!1})},e.clearData=function(t){t.preventDefault(),e.props.priceChartContainerRef.current.style.setProperty("display","none"),e.props.profitChartContainerRef.current.style.setProperty("display","none"),e.props.tableRef.current.setState({entries:[]}),e.props.entryEditorRef.current.setState({hidden:!0})},e.useSample=function(t){t.preventDefault(),fetch("/turnips-tracker/sample.json").then((function(t){if(t.ok)return t.text();e.reportError("Could not get sample data: ".concat(t.status," ").concat(t.statusText))})).then((function(t){return e.parseAndOpenJson(t)}))},e.openDataFileSelection=function(t){t.preventDefault();var n=e.turnipsFileInputRef.current;n.value="",n.click()},e.downloadData=function(t){t.preventDefault();var n=e.props.tableRef.current.state.entries.sort(w),a=JSON.stringify(n,null,2),r=encodeURIComponent(a),o=e.downloadDataFakeLinkRef.current;o.setAttribute("href","data:text/plain;charset:utf-8,"+r),o.click()},e.handleChange=function(t){var n,a;t.preventDefault();var r=null===(n=t.target)||void 0===n||null===(a=n.files)||void 0===a?void 0:a.item(0);r&&(r instanceof Blob?e.openAndParseJsonFile(r):console.log("Not a Blob, but a %s",typeof r))},e.openAndParseJsonFile=function(t){var n=new FileReader,a=e.props.tableRef.current;n.onload=function(t){var a=n.result;console.assert("string"===typeof a,"readAsText did not return a String result but a %s of value %s",null===a||void 0===a?void 0:a.constructor.name,a),e.parseAndOpenJson(a)},n.onerror=function(e){var t=n.error;console.error("Error occurred when reading turnips data file: %s",t),a.setState({errorMessage:"could not read file: ".concat(null===t||void 0===t?void 0:t.message)})},n.readAsText(t)},e.parseAndOpenJson=function(t){try{var n=JSON.parse(t);e.openJson(n)}catch(r){console.error("Error occurred when opening turnips data: %s",r);var a="more details in the console";r instanceof Error&&(a=r.message),e.reportError(a)}},e.openJson=function(t){var n=t.map(C);e.props.tableRef.current.setState({entries:n});var a=e.props.priceChartRef.current;a.chartInstance.data=D(n),a.chartInstance.update(),e.props.priceChartContainerRef.current.style.removeProperty("display");var r=e.props.profitChartRef.current;r.chartInstance.data=S(n),r.chartInstance.update(),e.props.profitChartContainerRef.current.style.removeProperty("display"),e.clearError()},e.reportError=function(t){return e.props.tableRef.current.setState({errorMessage:t})},e.clearError=function(){return e.props.tableRef.current.setState({errorMessage:void 0})},e}return Object(u.a)(n,[{key:"render",value:function(){return r.a.createElement("form",null,r.a.createElement("button",{onClick:this.createNewData},"New Turnips Data"),r.a.createElement("button",{onClick:this.openDataFileSelection},"Select Turnips Data"),r.a.createElement("input",{type:"file",id:"turnips-file",onChange:this.handleChange,style:{width:0,height:0},ref:this.turnipsFileInputRef}),r.a.createElement("button",{onClick:this.downloadData},"Save Turnips Data"),r.a.createElement("a",{download:"turnips-data.json",style:{width:0,height:0},ref:this.downloadDataFakeLinkRef}),r.a.createElement("button",{onClick:this.useSample},"Open Sample"),r.a.createElement("button",{onClick:this.clearData},"Clear"))}}]),n}(r.a.Component),N=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a,r;return Object(s.a)(this,n),(r=t.call(this,e)).addEntry=function(e){var t;try{t=C(e)}catch(i){return console.error("Failed to create TurnipsEntry: "+i),void(i instanceof Error&&r.setState({errorMessage:"Failed to create TurnipsEntry: "+i.message}))}var n=r.state.entries,a=E(t),o=n.findIndex((function(e){return E(e)===a}));o<0?n.push(t):n[o]=t,r.setState({entries:n.sort(w)})},r.handleVisibilityCheckbox=function(e){return r.setState({visible:e.target.checked})},r.state={entries:[],visible:null===(a=e.visible)||void 0===a||a},r}return Object(u.a)(n,[{key:"render",value:function(){if(!this.state)return r.a.createElement("p",null,"No Turnips Data Loaded");var e=this.state.errorMessage;if(e)return r.a.createElement("p",null,"Error when reading the turnips data: ",e);var t=this.state.visible;if(0===this.state.entries.length)return t?r.a.createElement("p",null,"No Turnips Data Loaded"):r.a.createElement("div",null);var n=r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",name:"visible",onChange:this.handleVisibilityCheckbox,checked:t}),"Show Detailed Table");if(!t)return r.a.createElement("div",null,n);var a=this.state.entries.sort(w).map((function(e){return function(e){var t,n,a=e.bought,o=e.sold,i=e.price;if(null!=a)if(n=a.toLocaleString(),a<=0)t="Bought none";else if(null!=i&&i>0){var l=(i*a).toLocaleString();t="Bought ".concat(n," for ").concat(l," (").concat(i,"/unit)")}else t="Bought ".concat(n," for an unknown price");else if(null!=o)if(n=o.toLocaleString(),o<=0)t="Sold none";else if(null!=i&&i>0){var c=(i*o).toLocaleString();t="Sold ".concat(n," for ").concat(c," (").concat(i,"/unit)")}else t="Sold ".concat(n," for an unknown price");else n="unknown",t="No data available";return r.a.createElement("tr",{key:E(e)},r.a.createElement("td",null,e.date," (",(s=e.date,h()(s,"yyyy-MM-DD").format("dddd")),") ",e.half),r.a.createElement("td",null,i),r.a.createElement("td",null,n),r.a.createElement("td",null,t));var s}(e)}));return r.a.createElement("div",null,n,r.a.createElement("table",{id:"turnips-table"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Date"),r.a.createElement("th",null,"Price"),r.a.createElement("th",null,"Bought / Sold"),r.a.createElement("th",null,"Detail"))),r.a.createElement("tbody",null,a)))}}]),n}(r.a.Component);function O(){var e=r.a.createRef(),t=r.a.createRef(),n=r.a.createRef(),a=r.a.createRef(),o=r.a.createRef(),i=r.a.createRef(),c=r.a.createRef();return l.b.global.maintainAspectRatio=!1,function(e){window.addEventListener("dragover",(function(e){return e.preventDefault()})),window.addEventListener("drop",(function(t){t.preventDefault();var n=t.dataTransfer.files[0];n&&e.current.openAndParseJsonFile(n)}))}(e),r.a.createElement("div",null,r.a.createElement(I,{ref:e,tableRef:t,priceChartRef:n,priceChartContainerRef:a,profitChartRef:o,profitChartContainerRef:i,entryEditorRef:c}),r.a.createElement(k,{ref:c,hidden:!0,tableRef:t,priceChartRef:n,priceChartContainerRef:a,profitChartRef:o,profitChartContainerRef:i}),r.a.createElement("div",{ref:a,style:{display:"none",position:"relative",height:"40vh",width:"95vw"}},r.a.createElement(l.a,{ref:n,data:{}})),r.a.createElement("div",{ref:i,style:{display:"none",position:"relative",height:"40vh",width:"95vw"}},r.a.createElement(l.a,{ref:o,data:{}})),r.a.createElement(N,{ref:t,visible:!1}))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(O,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},53:function(e,t,n){e.exports=n(154)},58:function(e,t,n){}},[[53,1,2]]]);
//# sourceMappingURL=main.60a97d7c.chunk.js.map